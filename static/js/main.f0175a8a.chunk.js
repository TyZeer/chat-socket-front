(this["webpackJsonpchat-socket-front"]=this["webpackJsonpchat-socket-front"]||[]).push([[0],{170:function(e,t,a){e.exports=a.p+"static/media/notification.9c2591ac.mp3"},177:function(e,t,a){e.exports=a(308)},183:function(e,t,a){},184:function(e,t,a){},222:function(e,t,a){},223:function(e,t,a){},271:function(e,t,a){},307:function(e,t,a){},308:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(24),o=a.n(s),c=a(40),l=a(162),i=(a(183),a(214)),m=a(175),u=a(312),d=a(313),g=a(69),h=a(317),p=a(318),f=a(319);const E="https://78.24.223.206:8085",v=async e=>{const t=new Headers;!1!==e.setContentType&&t.append("Content-Type","application/json"),localStorage.getItem("accessToken")&&t.append("Authorization","Bearer "+localStorage.getItem("accessToken"));const a={headers:t};return e=Object.assign({},a,e),fetch(e.url,e).then(e=>{const t=e.headers.get("content-type");return e.ok?t&&t.includes("application/json")?e.json():e.text():e.text().then(e=>(console.error("Server error:",e),Promise.reject(e)))}).catch(e=>(console.error("Request failed:",e),Promise.reject(e)))};function b(e){return v({url:E+"/api/files/"+e}).then(e=>e).catch(e=>(console.error("Error fetching file:",e),{url:""}))}a(184);var y=a(61);var S=e=>{const[t,a]=Object(n.useState)(!1);Object(n.useEffect)(()=>{null!==localStorage.getItem("accessToken")&&e.history.push("/")},[]);return r.a.createElement("div",{className:"login-container"},r.a.createElement(h.a,{style:{fontSize:50}}),r.a.createElement(u.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:t=>{var n;a(!0),(n=t,v({url:E+"/auth/sign-in",method:"POST",body:JSON.stringify(n)})).then(t=>{localStorage.setItem("accessToken",t.token),e.history.push("/"),a(!1)}).catch(e=>{401===e.status?m.a.error({message:"Error",description:"Username or Password is incorrect. Please try again!"}):m.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),a(!1)})}},r.a.createElement(u.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},r.a.createElement(d.a,{size:"large",prefix:r.a.createElement(p.a,{className:"site-form-item-icon"}),placeholder:"Username"})),r.a.createElement(u.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},r.a.createElement(d.a,{size:"large",prefix:r.a.createElement(f.a,{className:"site-form-item-icon"}),type:"password",placeholder:"Password"})),r.a.createElement(u.a.Item,null,r.a.createElement(g.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:t},"Log in")),"Not a member yet? ",r.a.createElement(y.Link,{to:"/signup"},"Sign up")))};a(222);var k=e=>{const[t,a]=Object(n.useState)(!1);Object(n.useEffect)(()=>{null!==localStorage.getItem("accessToken")&&e.history.push("/")},[]);return r.a.createElement("div",{className:"login-container"},r.a.createElement(h.a,{style:{fontSize:50}}),r.a.createElement(u.a,{name:"normal_login",className:"login-form",initialValues:{remember:!0},onFinish:t=>{var n;a(!0),(n=t,v({url:E+"/auth/sign-up",method:"POST",body:JSON.stringify(n)})).then(t=>{m.a.success({message:"Success",description:"Thank you! You're successfully registered. Please Login to continue!"}),console.log(t),localStorage.setItem("accessToken",null===t||void 0===t?void 0:t.token),e.history.push("/login"),a(!1)}).catch(e=>{m.a.error({message:"Error",description:e.message||"Sorry! Something went wrong. Please try again!"}),a(!1)})}},r.a.createElement(u.a.Item,{name:"username",rules:[{required:!0,message:"Please input your Username!"}]},r.a.createElement(d.a,{size:"large",placeholder:"Username"})),r.a.createElement(u.a.Item,{name:"email",rules:[{required:!0,message:"Please input your email!"}]},r.a.createElement(d.a,{size:"large",placeholder:"Email"})),r.a.createElement(u.a.Item,{name:"password",rules:[{required:!0,message:"Please input your Password!"}]},r.a.createElement(d.a,{size:"large",type:"password",placeholder:"Password"})),r.a.createElement(u.a.Item,null,r.a.createElement(g.a,{shape:"round",size:"large",htmlType:"submit",className:"login-form-button",loading:t},"Signup")),"Already a member? ",r.a.createElement(y.Link,{to:"/login"},"Log in")))},N=a(311),O=a(315);const j=Object(c.atom)({key:"loggedInUser",default:{},persistence_UNSTABLE:{type:"loggedInUser"}});Object(c.atom)({key:"chatActiveContact",persistence_UNSTABLE:{type:"chatActiveContact"}}),Object(c.atom)({key:"chatMessages",default:[],persistence_UNSTABLE:{type:"chatMessages"}});var w=a(320),T=a(70),C=a.n(T);a(223);const{Meta:P}=N.a;var I=e=>{const[t,a]=Object(c.useRecoilState)(j);Object(n.useEffect)(()=>{null===localStorage.getItem("accessToken")&&e.history.push("/login"),s()},[]);const s=()=>{(localStorage.getItem("accessToken")?v({url:E+"/auth/who-am-i",method:"POST"}):Promise.reject("No access token set.")).then(e=>{a(e)}).catch(e=>{console.log(e)})};return r.a.createElement("div",{className:"profile-container"},r.a.createElement(N.a,{style:{width:420,border:"1px solid #e1e0e0"},actions:[r.a.createElement(w.a,{onClick:()=>{localStorage.removeItem("accessToken"),e.history.push("/login")}})]},r.a.createElement(P,{avatar:r.a.createElement(O.a,{src:C.a,className:"user-avatar-circle"}),title:t.username,description:"@"+t.username}),r.a.createElement(g.a,null,r.a.createElement(y.Link,{to:"/chat"},"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u0447\u0430\u0442\u044b"))))},x=a(173),U=a(314),A=a(316),R=a(133),z=a.n(R);a(271);var L=e=>{let{chats:t,setChats:a,activeChat:n,setActiveChat:s,onAddChatClick:o,history:l}=e;const i=Object(c.useRecoilValue)(j);return r.a.createElement("div",{id:"sidepanel"},r.a.createElement("div",{id:"profile"},r.a.createElement("div",{className:"wrap"},r.a.createElement("img",{id:"profile-img",src:C.a,className:"online",alt:""}),r.a.createElement("p",null,i.username))),r.a.createElement("div",{id:"contacts"},r.a.createElement("ul",null,t.map((e,t)=>r.a.createElement("li",{onClick:()=>{s(e),e.hasNotification&&(e.hasNotification=!1,a(t=>t.map(t=>t.id===e.id?e:t)))},key:t,className:n&&e.id===n.id?"contact active":"contact"},r.a.createElement("div",{className:"wrap"},r.a.createElement("img",{id:e.id,src:C.a,alt:""}),r.a.createElement("div",{className:"meta"},r.a.createElement("p",{className:"name"},e.name)),e.hasNotification&&r.a.createElement("span",{style:{backgroundColor:"red"}})))))),r.a.createElement("div",{id:"bottom-bar"},r.a.createElement("button",{onClick:()=>{l.push("/")},id:"addcontact"},r.a.createElement("i",{className:"fa fa-user fa-fw","aria-hidden":"true"})," ",r.a.createElement("span",null,"Profile")),r.a.createElement("button",{onClick:o,id:"settings"},r.a.createElement("i",{className:"fa fa-cog fa-fw","aria-hidden":"true"})," ",r.a.createElement("span",null,"Add chat"))))};const J=e=>{let{file:t}=e;const[a,s]=r.a.useState("");return Object(n.useEffect)(()=>{b(t).then(e=>{s(e.url)})},[]),r.a.createElement("img",{src:null!==a&&void 0!==a?a:"",alt:"Attached",style:{maxWidth:"200px",width:"100%",marginBottom:"10px"}})};var M=e=>{let{file:t}=e;const[a,s]=Object(n.useState)("");return Object(n.useEffect)(()=>{b(t).then(e=>{s(e.url)})},[t]),r.a.createElement("a",{href:a,download:!0,target:"_blank",rel:"noopener noreferrer"},"Download File")};var B=e=>{var t;let{messages:a,currentUser:s,setMessages:o}=e;const[c,l]=Object(n.useState)(!1),[i,m]=Object(n.useState)(""),[u,h]=Object(n.useState)(null),[p,f]=Object(n.useState)(null),b=e=>{var t;(t=e,localStorage.getItem("accessToken")?v({url:`${E}/api/chat-messages/${t}`,method:"DELETE"}):Promise.reject("No access token set.")).then(()=>{o(t=>{const a=t.content.filter(t=>t.id!==e);return{...t,content:a}})}).catch(e=>{console.error("Error deleting message:",e)})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(z.a,{className:"messages"},r.a.createElement("ul",null,null===(t=a.content)||void 0===t?void 0:t.map((e,t)=>{var a,n;return r.a.createElement("li",{key:t,className:(null===(a=e.sender)||void 0===a?void 0:a.id)===s.id||e.sender===s.username?"sent":"replies",onContextMenu:t=>{t.preventDefault(),f(p===e.id?null:e.id)}},e.fileUrl&&(e.fileUrl.match(/\.(jpeg|jpg|gif|png|webp|bmp|svg)$/i)?r.a.createElement(J,{file:e.fileUrl}):r.a.createElement(M,{file:e.fileUrl})),r.a.createElement("p",null,e.content),(null===(n=e.sender)||void 0===n?void 0:n.id)===s.id&&p===e.id&&r.a.createElement("div",{className:"message-actions"},r.a.createElement(g.a,{type:"link",onClick:()=>{return t=e.id,a=e.content,h(t),m(a),void l(!0);var t,a}},"Edit"),r.a.createElement(g.a,{type:"link",danger:!0,onClick:()=>b(e.id)},"Delete")))}))),r.a.createElement(U.a,{title:"Edit Message",visible:c,onOk:()=>{var e,t;(e=u,t=i,localStorage.getItem("accessToken")?v({url:`${E}/api/chat-messages/${e}`,method:"PUT",body:JSON.stringify({content:t})}):Promise.reject("No access token set.")).then(e=>{o(t=>{const a=t.content.map(t=>t.id===e.id?e:t);return{...t,content:a}}),l(!1),h(null),m("")}).catch(e=>{console.error("Error editing message:",e)})},onCancel:()=>l(!1)},r.a.createElement(d.a.TextArea,{value:i,onChange:e=>m(e.target.value),rows:4})))};var F=e=>{let{text:t,setText:a,sendMessage:n,handleFileChange:s}=e;return r.a.createElement("div",{className:"message-input"},r.a.createElement("div",{className:"wrap"},r.a.createElement("input",{name:"user_input",size:"large",placeholder:"Write your message...",value:t,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"===e.key&&n(t)}}),r.a.createElement("input",{type:"file",onChange:s,style:{marginLeft:"10px"},className:"file-input",id:"file-input"}),r.a.createElement("label",{htmlFor:"file-input",className:"file-label"},r.a.createElement("i",{className:"fa fa-paperclip","aria-hidden":"true"})),r.a.createElement(g.a,{icon:r.a.createElement("i",{className:"fa fa-paper-plane","aria-hidden":"true"}),onClick:()=>n(t)})))},$=a(170),_=a.n($),q=null;var D=e=>{const t=Object(c.useRecoilValue)(j),[s,o]=Object(n.useState)(""),[l,i]=Object(n.useState)([]),[m,u]=Object(n.useState)(void 0),g=Object(n.useRef)(null),[h,p]=Object(n.useState)(null),[f,b]=Object(n.useState)(!1),[y,S]=Object(n.useState)({}),[k,N]=Object(n.useState)(!1),[O,w]=Object(n.useState)([]),[T,P]=Object(n.useState)([]),[I,R]=Object(n.useState)(""),[z,J]=Object(n.useState)(null);Object(n.useEffect)(()=>(null===localStorage.getItem("accessToken")&&e.history.push("/login"),M(),W(),()=>{q&&q.disconnect(()=>{console.log("Disconnected from WebSocket")}),h&&h.unsubscribe(),b(!1)}),[]),Object(n.useEffect)(()=>{g.current=m},[m]),Object(n.useEffect)(()=>{if(S({}),void 0!==m){if(async function(e){if(!localStorage.getItem("accessToken"))return Promise.reject("No access token set.");try{var t;const a=null===(t=await v({url:E+"/api/chat-messages/"+e,method:"GET"}))||void 0===t?void 0:t.totalElements;if(0===a)return{content:[]};return await v({url:`https://78.24.223.206:8085/api/chat-messages/${e}?sort=timestamp,asc&size=${a}`,method:"GET"})}catch(a){return console.error("Error fetching messages:",a),{content:[]}}}(m.id).then(e=>(console.log(e),S(e))),q.connected){const e=q.subscribe("/topic/chat/"+m.id,D);p(e)}W()}},[m]),Object(n.useEffect)(()=>{if(f&&m){const e=q.subscribe("/topic/chat/"+m.id,D);p(e)}},[f]);const M=()=>{const e=a(272);var n=a(279);n=new n("http://78.24.223.206:8082/ws"),(q=e.over(n)).connect({Authorization:"Bearer "+localStorage.getItem("accessToken")},(async function(e){b(!0),q.subscribe(`/user/${t.username}/queue/notifications`,$)})),q.onerror=function(e){console.log("WebSocket Error:",e)},q.debug=function(e){console.log(e)},q.onclose=function(){console.log("Connection closed")}},$=e=>{const t=JSON.parse(e.body),a=t.chatId;a?(new Audio(_.a).play().catch(e=>console.error("Error playing notification sound:",e)),i(e=>{console.log("Previous chats:",e);const t=e.find(e=>e.id==a);return t?(console.log(g,t),g.current&&g.current.id===t.id?e:(t.hasNotification=!0,e.map(e=>e.id===t.id?t:e))):(console.warn("Chat not found for notification:",a),e)})):console.warn("Received an empty or invalid notification:",t)},D=e=>{const t=JSON.parse(e.body);t&&(t.content||t.fileUrl)?S(e=>{const a=[...e.content||[]];return a.push({sender:t.sender,content:t.content,fileUrl:t.fileUrl}),{...e,content:a}}):console.warn("Received an empty or invalid message:",t)},W=()=>{(localStorage.getItem("accessToken")?v({url:E+"/api/chat-rooms/my",method:"GET"}):Promise.reject("No access token set.")).then(e=>Promise.all(e).then(e=>{console.log(e),i(e),void 0===m&&e.length>0&&u(e[0])}))};return r.a.createElement("div",{id:"frame"},r.a.createElement(L,{chats:l,activeChat:m,setActiveChat:e=>{e.id!==m.id&&(h&&h.unsubscribe(),u(e))},onAddChatClick:()=>{(localStorage.getItem("accessToken")?v({url:E+"/api/users",method:"GET"}):Promise.reject("No access token set.")).then(e=>{w(e),P([]),R(""),N(!0)})},history:e.history,setChats:i}),r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"contact-profile"},r.a.createElement("img",{src:m&&C.a,alt:""}),r.a.createElement("p",null,m&&m.name)),r.a.createElement(B,{messages:y,currentUser:t,setMessages:S}),r.a.createElement(F,{text:s,setText:o,sendMessage:async e=>{if(""===e.trim()&&!z)return void x.b.warning("Cannot send an empty message");let a=null;if(z)try{a=await function(e){const t=new FormData;return t.append("file",e),v({method:"POST",url:E+"/api/files/upload",setContentType:!1,body:t})}(z)}catch(r){return console.error("Error uploading file:",r),x.b.error("Failed to upload file"),void J(null)}const n={chatId:m.id,content:e,sender:t.username,...a&&{fileUrl:a}};q.send("/app/chat.sendMessage",{},JSON.stringify(n)),o(""),J(null)},handleFileChange:e=>{e.target.files.length>0&&J(e.target.files[0])}})),r.a.createElement(U.a,{title:"Select users to chat with",visible:k,onCancel:()=>N(!1),onOk:()=>{if(0===T.length)return void x.b.warning("Select at least one user");let e=I.trim();if(1===T.length){const t=O.find(e=>e.id===T[0]);e=t?t.username:e}else if(""===e)return void x.b.warning("Please enter a chat name");var t;(1===T.length?(t={name:e,user_id:T[0]},localStorage.getItem("accessToken")?v({url:E+"/api/chat-rooms/private",method:"POST",body:JSON.stringify(t)}):Promise.reject("No access token set.")):function(e){return localStorage.getItem("accessToken")?v({url:E+"/api/chat-rooms/group",method:"POST",body:JSON.stringify(e)}):Promise.reject("No access token set.")}({name:e,member_ids:T})).then(()=>{x.b.success("Chat created"),N(!1),W()}).catch(e=>{console.error(e),x.b.error("Could not create chat")})},okText:"Create chat"},r.a.createElement(d.a,{placeholder:"Enter chat name",value:I,onChange:e=>R(e.target.value),style:{marginBottom:16}}),r.a.createElement(A.a.Group,{style:{width:"100%"},value:T,onChange:e=>P(e)},O.map(e=>r.a.createElement(A.a,{key:e.id,value:e.id,style:{display:"block",margin:"8px 0"}},e.username)))))};a(307);r.a.createContext();var W=e=>r.a.createElement("div",{className:"App"},r.a.createElement(y.HashRouter,null,r.a.createElement(i.Switch,null,r.a.createElement(i.Route,{exact:!0,path:"/",render:e=>r.a.createElement(I,e)}),r.a.createElement(i.Route,{exact:!0,path:"/login",render:e=>r.a.createElement(S,e)}),r.a.createElement(i.Route,{exact:!0,path:"/signup",render:e=>r.a.createElement(k,e)}),r.a.createElement(i.Route,{exact:!0,path:"/chat",render:e=>r.a.createElement(D,e)}))));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));const{RecoilPersist:G,updateState:V}=Object(l.a)([],{key:"recoil-persist",storage:sessionStorage});o.a.render(r.a.createElement(c.RecoilRoot,{initializeState:V},r.a.createElement(G,null),r.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(e=>{e.unregister()}).catch(e=>{console.error(e.message)})},70:function(e,t,a){e.exports=a.p+"static/media/user.1f0a44cd.png"}},[[177,1,2]]]);
//# sourceMappingURL=main.f0175a8a.chunk.js.map